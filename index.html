<html>

<head>
    <style>
        #canvas {
            border: 1px solid black;
        }

        .slidecontainer {
            float: left;
            width: 100%;
            /* Width of the outside container */
        }
    </style>
</head>

<body>
    <canvas id='canvas' width='1200' height='600'></canvas>
    <div class='slidecontainer'>
        <span>QA</span>
        <input type="range" min="-10" max="10" step=".01" value="1" class="slider" id="qaSlider" />
        <span id='qaValue'></span>
    </div>
    <div class='slidecontainer'>
        <span>QB</span>
        <input type="range" min="-10" max="10" step=".01" value="1" class="slider" id="qbSlider" />
        <span id='qbValue'></span>
    </div>
    <div>
        <button id="startButton">Draw</button>
    </div>
</body>

<script>
    let sleep = ms => (new Promise(resolve => (setTimeout(resolve, ms))))
    let canvas = document.getElementById('canvas');
    let ctx = canvas.getContext('2d');
    let qaSlider = document.getElementById('qaSlider');
    let qaValue = document.getElementById('qaValue');
    let qbSlider = document.getElementById('qbSlider');
    let qbValue = document.getElementById('qbValue');
    let startButton = document.getElementById('startButton');
    const HEIGHT = canvas.height;
    const WIDTH = canvas.width;
    let opts = {
        ctx,
        HEIGHT,
        WIDTH,
        TL: .004,
        XA: 400,
        YA: HEIGHT / 2,
        XB: 800,
        YB: HEIGHT / 2,
        QA: .5,
        QB: 1,
    }

    qaSlider.value = opts.QA;
    qaValue.innerHTML = opts.QA;
    qbSlider.value = opts.QB;
    qbValue.innerHTML = opts.QB;

    qaSlider.oninput = async function () {
        opts.QA = this.value;
        qaValue.innerHTML = opts.QA;
    }

    qbSlider.oninput = async function () {
        opts.QB = this.value;
        qbValue.innerHTML = opts.QB;
    }


    startButton.onclick = async function () {
        render(opts);
    }

    render(opts).then(() => {
        console.log('Done');
    });

    async function render(opts) {
        let { ctx, HEIGHT, WIDTH, TL, XA, YA, XB, YB, QA, QB } = opts;
        let vMax = Number.NEGATIVE_INFINITY;
        let vMin = Number.POSITIVE_INFINITY;
        let dy = [];
        ctx.clearRect(0, 0, WIDTH, HEIGHT);
        //await sleep(0);
        for (let y = 0; y < HEIGHT; y++) dy.push(Math.pow((y - HEIGHT / 2), 2));
        let plot = [];
        for (let x = 0; x < WIDTH; x++) {
            plot.push([]);
            let dxa = (x - XA) * (x - XA);
            let dxb = (x - XB) * (x - XB);
            for (let y = 0; y < HEIGHT; y++) {
                let v = 'point';
                let da = Math.sqrt(dxa + dy[y]);
                let db = Math.sqrt(dxb + dy[y]);
                if (da > 2 && db > 2) {
                    v = ((QA / da) + (QB / db));
                    if (v > vMax) vMax = v;
                    if (v < vMin) vMin = v;
                }
                plot[x][y] = v;
            }
        }

        let range = vMax - vMin;
        for (let x = 0; x < WIDTH; x++) {
            for (let y = 0; y < HEIGHT; y++) {
                let v = plot[x][y];
                let alpha = Math.abs(v / range) * 48;
                let color;
                if (v === 'point') color = '#000000';
                else if (v > 0) color = `rgba(255,0,0,${alpha})`;
                else color = `rgba(0,0,255,${alpha})`;
                ctx.fillStyle = color;
                ctx.fillRect(x, y, 1, 1);
            }
            await sleep(0);
        }
    }

</script>

</html>